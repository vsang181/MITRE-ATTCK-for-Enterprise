# IP Addresses

IP Address reconnaissance is a sub-technique of Gather Victim Network Information (**MITRE ATT&CK T1590.005**) in which adversaries enumerate the public IP address ranges allocated to a target organisation to map its internet-facing infrastructure, identify active hosts and exposed services, and derive additional organisational intelligence.  IP address intelligence can reveal a broad range of operationally useful details beyond raw addressing data, including the organisation's approximate size based on allocated address block magnitude, physical geographic locations inferred from IP geolocation, internet service provider relationships, and whether public-facing infrastructure is hosted on-premises or within cloud provider address space. 
Because IP addresses are publicly assigned and documented through a globally mandated hierarchical allocation system administered by **IANA (Internet Assigned Numbers Authority)** and distributed to organisations through five **Regional Internet Registries (RIRs)** — **ARIN**, **RIPE NCC**, **APNIC**, **LACNIC**, and **AFRINIC** — the complete IP address footprint of an organisation is inherently a matter of public record that adversaries can enumerate without interacting with target infrastructure.  The gathered intelligence can directly inform further reconnaissance (e.g., **T1595 – Active Scanning**, **T1593 – Search Open Websites/Domains**), support resource development (e.g., **T1583 – Acquire Infrastructure**, **T1584 – Compromise Infrastructure**), and enable initial access via **T1133 – External Remote Services**. 

***

## Collection Vectors

Adversaries leverage multiple passive and active methods to enumerate the IP address ranges allocated to a target organisation:

- **RIR and WHOIS Database Queries:** The five regional internet registries maintain publicly queryable databases mapping IP address blocks (expressed as CIDR notation, e.g., `192.168.1.0/24`) to their registered organisational owners.  Adversaries query these databases directly through their web interfaces (**ARIN**, **RIPE NCC**, **APNIC**), through command-line WHOIS utilities (`whois <IP or organisation name>`), or through programmatic APIs to enumerate all IP blocks registered under the target's organisation name.  IP CIDR blocks use prefix length notation to define the number of addresses in a range: a `/16` contains approximately 64,000 addresses, a `/24` contains 256 addresses, and a `/26` contains 64, enabling adversaries to rapidly assess the scale of an organisation's internet presence from block size alone. 
- **ASN-Based IP Range Enumeration:** Organisations controlling significant IP address allocations are typically assigned one or more **Autonomous System Numbers (ASNs)** that group their routing infrastructure. Tools such as [ASNmap](https://github.com/projectdiscovery/asnmap), [BGP.he.net](https://bgp.he.net/), and [ipinfo.io](https://ipinfo.io/) resolve ASNs to their complete associated IP prefix lists, enabling adversaries to enumerate the full routed IP address footprint of a target organisation in a single operation. 
- **Specialised IP Range Discovery Tools:** Tools such as [NetblockTool](https://www.netspi.com/blog/technical-blog/network-pentesting/netblocktool/) automate the IP range discovery process by cross-referencing multiple sources including Google dork results, ARIN database scraping, and IPinfo APIs to return a comprehensive and ranked list of netblocks associated with a target organisation, including address blocks belonging to subsidiaries and affiliated entities.  NetblockTool assigns a confidence score to each discovered netblock based on naming and registration characteristics, significantly reducing the manual effort required for comprehensive IP range enumeration. 
- **Commercial IP Intelligence APIs:** Services such as [IPinfo IP Ranges API](https://ipinfo.io/products/ranges-api), [Censys](https://censys.io/), and [Shodan](https://www.shodan.io/) provide programmatic access to pre-enumerated IP ranges, active host inventories, and associated service data for a given organisation or domain, enabling adversaries to access comprehensive and regularly updated IP intelligence without performing primary enumeration themselves. 
- **Passive DNS and Certificate Transparency Correlation:** IP addresses can be enumerated indirectly by resolving all DNS A records for a target's known domains and subdomains, or by extracting IP addresses embedded within SSL/TLS certificates indexed in transparency logs such as [crt.sh](https://crt.sh/). This approach surfaces IP addresses that may not be directly documented in RIR databases, including cloud-hosted infrastructure and CDN origin servers.
- **Credential Harvesting Site Visitor IP Logging:** Adversaries deploy phishing and credential harvesting pages that capture the IP addresses of visiting users, as documented in **Magic Hound's** operational use of this technique.  This enables adversaries to enumerate the IP address ranges used by the target organisation's employees for internet egress, revealing the organisation's outbound IP addresses and potentially identifying corporate VPN gateway ranges for subsequent scanning operations. 

***

## Procedure Examples

### Andariel
**Andariel** is a North Korean state-sponsored threat actor group operating as a sub-group of **Lazarus Group**, conducting financially motivated and espionage-focused operations against defence, financial, and critical infrastructure targets. The group applied its IP address reconnaissance intelligence operationally by **limiting its watering hole attacks to specific IP address ranges** associated with its intended targets.  Rather than broadly serving malicious content to all visitors, Andariel served exploit payloads exclusively to visitors whose IP addresses fell within ranges belonging to target organisations, significantly reducing the risk of premature detection while ensuring payload delivery precision against the intended victims. 

### HAFNIUM
**HAFNIUM** conducted IP address reconnaissance as part of its structured pre-exploitation reconnaissance against Microsoft Exchange Server targets, specifically obtaining the public IP addresses of **internet-facing Exchange servers** within victim organisations.  This intelligence enabled HAFNIUM to precisely direct its **ProxyLogon** exploitation campaigns (CVE-2021-26855, CVE-2021-26857, CVE-2021-26858, CVE-2021-27065) against specific, reachable Exchange infrastructure, avoiding the detection risk associated with broad, untargeted internet scanning while maximising exploitation effectiveness against confirmed targets. 

### Magic Hound (APT35 / Charming Kitten)
**Magic Hound** integrated IP address collection directly into its phishing infrastructure operations, instrumenting credential harvesting pages to **capture and log the IP addresses of all visitors** to the adversary-controlled sites.  This technique enabled the group to enumerate the IP address ranges used by employees of targeted organisations for internet access, validating which target organisations had personnel engaging with the phishing infrastructure and building an IP address profile of the target's egress infrastructure for use in subsequent operational planning. 

***

## Mitigations: Pre-Compromise (MITRE M1056)

IP address reconnaissance is conducted predominantly through passive queries against publicly mandated RIR databases and commercial IP intelligence platforms, placing collection activity entirely outside the reach of enterprise network controls.  Mitigation efforts should focus on minimising the actionable intelligence derivable from allocated IP address ranges and hardening the services exposed across those ranges: 

- **Minimise exposed services across the public IP footprint:** Conduct regular audits of all services exposed across the organisation's allocated public IP ranges using **External Attack Surface Management (EASM)** platforms such as [Microsoft Defender EASM](https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-external-attack-surface-management), [Censys ASM](https://censys.io/), and [Cortex Xpanse](https://www.paloaltonetworks.com/cortex/xpanse) to identify and remediate unnecessarily exposed services, reducing the actionable intelligence available from IP-based scanning.
- **Use cloud and CDN infrastructure to obscure origin IPs:** Deploy **Content Delivery Networks (CDNs)** such as [Cloudflare](https://www.cloudflare.com/) and [Akamai](https://www.akamai.com/) in front of public-facing web infrastructure to mask the true origin server IP addresses from external parties, preventing adversaries from directly targeting origin infrastructure even after enumerating publicly assigned IP ranges.
- **Implement proactive vulnerability management across the IP footprint:** Ensure continuous vulnerability scanning and remediation across all hosts within the organisation's allocated IP address ranges using platforms such as [Tenable.io](https://www.tenable.com/products/tenable-io) and [Qualys VMDR](https://www.qualys.com/apps/vulnerability-management-detection-response/) to minimise the window during which newly discovered vulnerabilities are exploitable on internet-facing hosts.
- **Deploy IP-based access controls on sensitive externally facing services:** Where operationally feasible, restrict access to sensitive external services such as VPN gateways, management portals, and administrative interfaces to known organisational egress IP ranges, reducing the attack surface accessible from arbitrary internet IP addresses.

***

## Detection Strategy

### Passive Collection Visibility Limitations

IP address reconnaissance conducted through RIR database queries, ASN lookups, and commercial IP intelligence platforms operates entirely through public data sources and generates no network-level artefacts within the target organisation's infrastructure.  There is no detectable footprint associated with an adversary querying ARIN or RIPE NCC databases for the organisation's IP allocations, making direct detection of this reconnaissance sub-technique infeasible through conventional monitoring controls. 

### Downstream Scanning and Exploitation Detection

Detection efforts yield the most operational value when focused on the **Active Scanning** and **Initial Access** stages at which IP address intelligence is applied. Defenders should monitor for:

- **Systematic port scanning patterns** across the organisation's allocated IP ranges, detectable through **network flow analysis** tools such as [Zeek](https://zeek.org/) and [Suricata](https://suricata.io/) monitoring for sequential connection attempts and ICMP sweep activity from single external source IPs. 
- **Exploitation attempts against internet-facing services** including VPN appliances, Exchange servers, and remote desktop infrastructure at addresses within the allocated IP ranges, correlatable with prior scanning activity through **SIEM** platforms such as [Splunk](https://www.splunk.com/) or [Microsoft Sentinel](https://azure.microsoft.com/en-us/products/microsoft-sentinel).
- **Watering hole IP filtering patterns:** Web server access logs should be monitored for request patterns characteristic of IP-targeted watering hole delivery, such as server-side code conditionally serving different content based on visitor IP ranges, which may indicate that previously compromised watering hole infrastructure is delivering targeted payloads specifically to the organisation's egress IP addresses. 
- **Threat intelligence enrichment:** Integrate IP reputation data from services such as [AbuseIPDB](https://www.abuseipdb.com/), [VirusTotal](https://www.virustotal.com/), and [Recorded Future](https://www.recordedfuture.com/) into SIEM correlation rules to identify scanning and probing activity originating from known adversarial or botnet-associated IP ranges targeting the organisation's allocated IP space. 
