# Client Configurations

Client configuration reconnaissance is a sub-technique of Gather Victim Host Information (**MITRE ATT&CK T1592.004**) in which adversaries collect detailed information about the configuration state of victim client systems to inform targeting and payload delivery decisions. Intelligence gathered through this sub-technique may encompass operating system type and version, CPU architecture (32-bit x86 vs. 64-bit x64 vs. ARM), virtualisation status, system language and locale settings, time zone configuration, installed browser plugins, and cloud tenancy or directory service details. This granular configuration intelligence enables adversaries to construct precisely tailored attack payloads, select architecture-compatible shellcode and executables, and anticipate sandbox or analysis environment indicators that may suggest the host is not a genuine target system.

Client configuration details are particularly valuable when adversaries intend to deploy malware that performs **environment keying**, a technique in which a payload checks specific host configuration attributes before executing its primary function, ensuring it activates only on genuine target systems while remaining dormant or self-terminating in sandboxed analysis environments. Additionally, understanding a target's system language and time zone settings enables adversaries to refine the believability and timing precision of **spearphishing** and **Business Email Compromise (BEC)** campaigns, crafting communications that align with the recipient's regional working hours and linguistic expectations. Gathered intelligence can support further reconnaissance (e.g., **T1593 – Search Open Websites/Domains**, **T1596 – Search Open Technical Databases**), capability development (e.g., **T1587 – Develop Capabilities**, **T1588 – Obtain Capabilities**), and initial access operations (e.g., **T1195 – Supply Chain Compromise**, **T1133 – External Remote Services**).

***

## Collection Vectors

Adversaries may gather client configuration intelligence through multiple active and passive collection methods:

- **HTTP User-Agent Header Analysis:** Every HTTP request transmitted by a client browser contains a `User-Agent` string that discloses the browser application, rendering engine, operating system, and CPU architecture. Adversary-controlled phishing pages and watering hole infrastructure passively harvest these values from inbound connections, deriving OS version, architecture, and browser configuration without any active probing of the target network.
- **JavaScript-Based Fingerprinting:** Malicious or adversary-controlled web pages may execute JavaScript to enumerate client configuration details beyond what the User-Agent string discloses, including screen resolution, colour depth, timezone offset (`Intl.DateTimeFormat().resolvedOptions().timeZone`), system language (`navigator.language`), CPU thread count (`navigator.hardwareConcurrency`), available device memory (`navigator.deviceMemory`), and installed browser plugins. Collectively, these attributes form a highly specific client configuration fingerprint.
- **Virtualisation Detection:** Adversaries may include scripts or payloads designed to detect whether the client system is running within a virtual machine or sandbox environment, using indicators such as screen resolution thresholds, absence of battery status APIs on desktop systems, GPU renderer strings characteristic of virtual environments (e.g., `VMware SVGA`, `VirtualBox`), and timing discrepancies in JavaScript execution. Hosts identified as virtualised may be excluded from payload delivery to evade automated malware analysis.
- **Cloud Tenancy and Directory Enumeration:** Adversaries may interact directly with cloud service provider APIs and identity federation endpoints to enumerate tenant configuration details. For example, Microsoft Azure AD (now **Microsoft Entra ID**) exposes a publicly accessible OpenID Connect discovery endpoint (`https://login.microsoftonline.com/<tenant>/.well-known/openid-configuration`) and the **Microsoft AutoDiscover** service can be queried to determine whether a given domain uses Office 365 or on-premises Exchange, revealing cloud tenancy configuration without authentication.
- **Active Scanning:** Tools such as [Nmap](https://nmap.org/) with OS detection scripts (`-O`), [Masscan](https://github.com/robertdavidgraham/masscan), and web application fingerprinting tools such as [WhatWeb](https://github.com/urbanadventurer/WhatWeb) can enumerate operating system version and architecture details from internet-facing services via TCP/IP stack fingerprinting and banner analysis.
- **OSINT from Public Data Sources:** Client configuration details may be inadvertently disclosed through job postings specifying required OS environments, employee resumes listing technology platforms, and corporate procurement records referencing software licensing agreements.

***

## Procedure Example: HAFNIUM

**HAFNIUM** is a Chinese state-sponsored threat actor group assessed to operate on behalf of the People's Republic of China's Ministry of State Security (MSS). The group is best known for the **March 2021 exploitation of four zero-day vulnerabilities in Microsoft Exchange Server** (collectively referred to as **ProxyLogon**: CVE-2021-26855, CVE-2021-26857, CVE-2021-26858, and CVE-2021-27065), which affected hundreds of thousands of on-premises Exchange deployments worldwide.

As part of its pre-compromise reconnaissance operations, HAFNIUM directly interacted with **Microsoft Office 365 tenants** to enumerate target environment configuration details, including tenancy structure, domain federation settings, and the presence of on-premises versus cloud-hosted Exchange infrastructure. This configuration intelligence informed HAFNIUM's targeting decisions, enabling the group to identify organisations running vulnerable on-premises Exchange Server deployments versus those fully migrated to Exchange Online, and to scope exploitation operations accordingly. The group leveraged tools such as **Nmap**, **Covenant**, and custom web shells post-compromise to further enumerate client and server configurations within the target environment.

***

## Mitigations: Pre-Compromise (MITRE M1056)

Client configuration reconnaissance operates predominantly through passive collection against publicly accessible infrastructure and adversary-controlled web pages visited by target personnel, placing it outside the effective scope of conventional enterprise perimeter controls. Mitigation efforts should focus on reducing the configuration intelligence available to adversaries through the following measures:

- **Suppress HTTP response metadata:** Configure internet-facing web servers and application gateways to remove or genericise version and platform identifiers from HTTP response headers, including `Server:`, `X-Powered-By:`, `X-AspNet-Version:`, and `X-Runtime` headers. This limits the configuration intelligence obtainable through passive response analysis.
- **Implement browser isolation:** Deploy **browser isolation** solutions such as [Cloudflare Browser Isolation](https://www.cloudflare.com/en-gb/zero-trust/products/browser-isolation/) or [Menlo Security](https://www.menlosecurity.com/) for high-risk user populations, executing web browsing in a remote isolated environment to prevent JavaScript-based client fingerprinting scripts from accessing genuine host configuration data.
- **Enforce strict Content Security Policies (CSP):** Apply rigorous CSP headers across all organisational web properties to restrict the execution of unauthorised third-party scripts that may be embedded within compromised pages for client-side configuration harvesting.
- **Restrict cloud tenancy enumeration:** Harden Microsoft Entra ID and Office 365 tenant configurations to limit the information exposed through public discovery endpoints. Disable or restrict **AutoDiscover** and **AutoDetect** service responses to prevent adversaries from enumerating tenancy and infrastructure configuration details through unauthenticated queries. Microsoft Secure Score recommendations within [Microsoft Defender for Office 365](https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-for-office-365) provide guidance on hardening tenant exposure.
- **Audit public-facing data sources:** Regularly review job postings, corporate websites, and employee professional profiles for inadvertent disclosure of client operating system environments, virtualisation platforms, and technology stack configurations.

***

## Detection Strategy

### Client Fingerprinting and Anomalous Web Content Detection

Detection of client configuration gathering presents challenges analogous to those encountered across other T1592 sub-techniques, as collection activity is predominantly passive and occurs outside the target organisation's direct visibility. Web server and application gateway access logs should capture full HTTP request header data, including `User-Agent` strings, `Accept-Language` headers, and referrer information, forwarded to a centralised **SIEM platform** such as [Splunk](https://www.splunk.com/) or [Microsoft Sentinel](https://azure.microsoft.com/en-us/products/microsoft-sentinel) for correlation. Anomalous patterns such as high volumes of requests bearing identical or non-standard User-Agent strings, or requests from automated tools known to perform configuration enumeration, should be flagged for review. **Web Application Firewalls (WAFs)** such as [Cloudflare WAF](https://www.cloudflare.com/en-gb/application-services/products/waf/) and [AWS WAF](https://aws.amazon.com/waf/) can provide additional detection coverage through signature-based rules targeting fingerprinting tool behaviour.

### Detection Pivot to Initial Access Indicators

As the reconnaissance phase itself remains largely undetectable, detection resources should be concentrated on the **Initial Access** stage at which gathered client configuration intelligence is operationally applied. Defenders should monitor for exploitation attempts specifically targeting OS versions or application configurations consistent with those deployed across the organisation, anomalous Office 365 tenant enumeration activity in **Microsoft Entra ID sign-in logs**, and inbound connections from infrastructure associated with known adversary groups identified through threat intelligence platforms such as [Recorded Future](https://www.recordedfuture.com/) and [MISP](https://www.misp-project.org/). Enabling **Microsoft Entra ID Identity Protection** and **Unified Audit Logging** within Office 365 tenants provides visibility into abnormal authentication patterns and external tenant interaction attempts consistent with the HAFNIUM-style enumeration behaviour documented within this sub-technique.
